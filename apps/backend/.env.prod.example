# Backend Production Environment Variables
# Copy this file to .env.prod and generate secure values for all secrets

NODE_ENV=production
PORT=3001
HOST=0.0.0.0
LOG_LEVEL=info

# Service Role Configuration
# SERVICE_ROLE can be "api", "worker", or "all"
# - "api": Run only the HTTP API server (workers disabled)
# - "worker": Run only queue workers (API disabled)
# - "all": Run both API server AND workers in one process (recommended for simple deployments)
SERVICE_ROLE=all

# Queue Backend Configuration
# QUEUE_BACKEND can be "redis", "postgres", or "sqlite"
# - "redis": Use Redis/BullMQ for job queues (requires REDIS_URL)
# - "postgres": Use PostgreSQL for job queues (supports remote workers)
# - "sqlite": Use SQLite for job queues (only valid with SERVICE_ROLE=all)
QUEUE_BACKEND=sqlite

# Database Configuration
# DATABASE_TYPE can be "postgresql", "pglite", or "sqlite"
# - "postgresql": Full PostgreSQL server (recommended for production)
# - "pglite": Embedded PostgreSQL (for simple deployments)
# - "sqlite": File-based database (lightweight alternative)
DATABASE_TYPE=sqlite
#DATABASE_TYPE=pglite
#DATABASE_TYPE=postgresql

# PostgreSQL (production with Docker container networking)
# Password 'eclaire' matches default in pm2.deps.config.js - change both together if needed
DATABASE_URL=postgresql://eclaire:eclaire@eclaire-postgres:5432/eclaire

# PGlite Configuration (only used when DATABASE_TYPE=pglite)
# Path where PGlite stores its file-based database (container path)
PGLITE_DATA_DIR=./data/pglite

# SQLite Configuration (only used when DATABASE_TYPE=sqlite)
# Path where SQLite stores its database file (container path)
SQLITE_DB_PATH=./data/sqlite/sqlite.db

# Redis Configuration (required when QUEUE_BACKEND=redis, production with Docker container networking)
REDIS_URL=redis://eclaire-redis:6379

# Frontend URL (your production domain)
FRONTEND_URL=https://app.your-domain.com

# Storage directories (production paths)
USERS_DIR=./data/users
DATA_DIR=./data
LOGS_DIR=./data/logs
CONFIG_DIR=./config

# AI Configuration - Active model selection is configured in data/config/models.json
# The activeModel.backend setting in JSON config determines which model is used
AI_LOCAL_PROVIDER_URL=http://host.docker.internal:11434
#AI_PROXY_PROVIDER_URL=https://openrouter.ai/api/v1/chat/completions
#AI_PROXY_API_KEY=
AI_PROMPT_LOGGING_ENABLED=true

# Worker Configuration (only used when SERVICE_ROLE=worker or all)
# Port for standalone worker service (not used in SERVICE_ROLE=all mode)
WORKER_PORT=3002
# Number of concurrent jobs to process
WORKER_CONCURRENCY=5
# AI processing timeout in milliseconds
AI_TIMEOUT=180000

# Worker API Configuration (for internal worker-to-backend communication)
# Use container names for Docker networking
BACKEND_URL=http://eclaire-backend:3001
API_BASE_URL=http://eclaire-backend:3001

# Worker AI Configuration (workers can use different AI server than backend)
WORKER_AI_LOCAL_PROVIDER_URL=http://host.docker.internal:11435
#WORKER_AI_PROXY_PROVIDER_URL=https://openrouter.ai/api/v1/chat/completions
#WORKER_AI_PROXY_API_KEY=

# External Services
DOCLING_SERVER_URL=http://host.docker.internal:5001

# Worker Storage Configuration (container paths)
BROWSER_DATA_DIR=/app/data/browser-data
WORKER_SHARED_DATA_PATH=/app/data/users

# Worker API Keys (MUST GENERATE SECURE VALUES FOR PRODUCTION)
# These keys are used for internal worker authentication
# Generate secure API keys in the backend and copy them here
# Format: sk-{15 alphanumeric chars}-{32 alphanumeric chars}
WORKER_API_KEY=
AI_ASSISTANT_API_KEY=

# Optional: Reddit API Configuration (for Reddit bookmark processing)
#REDDIT_CLIENT_ID=
#REDDIT_CLIENT_SECRET=

# Optional: GitHub Personal Access Token (for higher rate limits on GitHub bookmarks)
#GITHUB_TOKEN=

# Security Configuration
# Authentication (MUST GENERATE SECURE VALUE FOR PRODUCTION)
BETTER_AUTH_SECRET=
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"

# Master Encryption Key (MUST GENERATE SECURE VALUE FOR PRODUCTION)
# Must be 32 bytes (64 hex chars). Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
MASTER_ENCRYPTION_KEY=

# API Key HMAC Security (MUST GENERATE SECURE VALUES FOR PRODUCTION)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
API_KEY_HMAC_VERSION=1
API_KEY_HMAC_KEY_V1=

