# Contributor Guide

## Prerequisites

- Node.js 24+
- pnpm 10+
- Docker and Docker Compose
- A local LLM server (llama.cpp, Ollama, etc.)

## Quick Start

- Clone + setup:
  - `git clone https://github.com/eclaire-labs/eclaire`
  - `cd eclaire`
  - `corepack enable`
  - `pnpm setup:dev`
- Start dependencies (PostgreSQL + Docling):
  - `docker compose -f compose.yaml -f compose.dev.yaml up -d postgres docling`
- Start an LLM server on your host (example):
  - `llama-server --port 11500`
- Start the dev servers:
  - `pnpm dev`
- Open:
  - Frontend: `http://localhost:3000`
  - Backend health: `http://localhost:3001/health`

## Environment Basics
- All config comes from repo-root `.env` (generated by `pnpm setup:dev`).
- Runtime defaults are derived from `ECLAIRE_RUNTIME` (you usually do not set wiring URLs manually).
- AI config lives in `config/ai/*.json` (copied from `*.example` by setup).

## Common Commands
- Dev:
  - `pnpm dev`
  - `pnpm dev:backend`
  - `pnpm dev:frontend`
- DB:
  - `pnpm app:upgrade`
  - `pnpm --filter @eclaire/backend db:seed:test`

## Testing

### Unit tests (safe by default, no server/Docker needed)
- All packages: `pnpm test`
- Backend only: `pnpm --filter @eclaire/backend test`
- Backend DB tests: `pnpm --filter @eclaire/backend test:db`
- Frontend only: `pnpm --filter @eclaire/frontend test`

### Integration tests (require running services)

**API Integration** (requires server + seeded DB):
- Terminal 1: `pnpm test:integration:api:start` (sets up DB, seeds, starts server)
- Terminal 2: `pnpm test:integration:api` (runs tests)

  OR
    cd apps/backend

    # Run all integration tests
    pnpm test:integration

    # Run specific feature tests
    pnpm test:notes
    pnpm test:tasks
    pnpm test:bookmarks
    pnpm test:channels
    pnpm test:documents
    pnpm test:photos
    pnpm test:user
    pnpm test:auth-session
    pnpm test:auth-api-key
    pnpm test:ai-conversations
    pnpm test:ai-prompt
    pnpm test:ai-prompt-stream
    pnpm test:ai-model-eval

    # Task sub-tests
    pnpm test:tasks:crud
    pnpm test:tasks:search
    pnpm test:tasks:recurrence
    pnpm test:tasks:comments


**AI Integration** (requires local LLM or API key):
- Local llama.cpp: `pnpm test:integration:ai:local`
- OpenRouter: `OPENROUTER_API_KEY=... pnpm test:integration:ai:openrouter`
- Note: Tests the @eclaire/ai package directly, no backend server needed

**Queue/BullMQ** (requires Redis):
- `pnpm test:integration:bullmq`
- Note: Tests the @eclaire/queue package directly, no backend server needed
